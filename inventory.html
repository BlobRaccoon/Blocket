<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blocket | Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-tab { background: #808080; color: #ffffff !important; }
        body { background:#121212; font-family: 'Inter', sans-serif; }
        .block-card img { image-rendering: auto; transition: transform 0.2s ease; }
        .block-card:hover { transform: translateY(-5px); }
        .block-card:hover img { transform: scale(1.1); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        .pack-header {
            border-left: 4px solid #808080;
            padding-left: 1rem;
        }
    </style>
</head>
<body class="text-white flex h-screen overflow-hidden">

     <div class="w-64 bg-[#1a1a1a] border-r border-neutral-800 flex flex-col p-6 shadow-2xl">
        <h2 class="text-2xl font-black italic mb-10 tracking-tighter text-[#808080]">BLOCKET</h2>
        <nav class="flex flex-col gap-2 flex-grow">
            <a href="/stats" id="nav-stats" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition flex items-center gap-3"><span>ğŸ“Š</span> Stats</a>
            <a href="/inventory" id="nav-inventory" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition flex items-center gap-3"><span>ğŸ’</span> Inventory</a>
            <a href="/market" id="nav-market" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition flex items-center gap-3"><span>ğŸ›’</span> Market</a>
            <a href="/explorer" id="nav-explorer" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition flex items-center gap-3"><span>ğŸŒ</span> Explorer</a>
            <a href="/chat" id="nav-chat" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition flex items-center gap-3"><span>ğŸ’¬</span> Chat</a>

            <div class="my-4 border-t border-slate-700"></div>

            <a href="/view/credits" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition text-sm flex items-center gap-3"><span>ğŸ“œ</span> Credits</a>
            <a href="/view/terms" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition text-sm flex items-center gap-3"><span>âš–ï¸</span> Terms</a>
            <a href="/view/privacy" class="p-3 rounded-lg font-bold text-slate-400 hover:bg-slate-800 transition text-sm flex items-center gap-3"><span>ğŸ”’</span> Privacy</a>
        </nav>

        <div class="mt-auto pt-4 border-t border-neutral-800 mb-4">
            <p id="username-display" class="text-xs font-black uppercase text-neutral-500 tracking-widest">Loading...</p>
        </div>

        <a href="/logout" class="bg-neutral-800 text-neutral-400 p-3 rounded-lg text-center font-bold hover:bg-red-900/20 hover:text-red-500 transition border border-neutral-700">LOGOUT</a>
    </div>

    <div class="flex-grow p-10 overflow-y-auto bg-[#0f0f0f]">
        <header class="mb-12 flex justify-between items-end border-b border-neutral-800 pb-8">
            <div>
                <h1 class="text-7xl font-black italic uppercase tracking-tighter">Inventory</h1>
                <div id="role" class="inline-block bg-[#808080]/10 text-[#808080] font-black text-[10px] px-3 py-1 rounded-md mt-4 uppercase tracking-widest border border-[#808080]/20">...</div>
            </div>
            <div class="text-right">
                <div class="text-neutral-500 text-xs font-black uppercase tracking-widest mb-1">Total Blocks</div>
                <div id="total" class="text-6xl font-black text-white italic">0</div>
            </div>
        </header>

        <div id="inventory-groups" class="space-y-16"></div>
    </div>

    <script>
        document.getElementById('nav-inventory').classList.add('active-tab');

        const rarityColors = {
            'Godlike': '#ff4444',
            'Mythical': '#a855f7',
            'Legendary': '#eab308',
            'Epic': '#ec4899',
            'Rare': '#3b82f6',
            'Uncommon': '#22c55e',
            'Common': '#94a3b8',
            'Super Common': '#525252'
        };

        const rarityWeight = {
            'Super Common': 1, 'Common': 2, 'Uncommon': 3, 'Rare': 4,
            'Epic': 5, 'Legendary': 6, 'Mythical': 7, 'Godlike': 8
        };

        async function loadInventory() {
            const token = localStorage.getItem('token');
            try {
                const res = await fetch('/api/userdata', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const user = await res.json();

                document.getElementById('username-display').innerText = user.username;
                document.getElementById('role').innerText = user.role;

                const items = Object.values(user.inventory || {});
                const totalCount = items.reduce((sum, item) => sum + (item.count || 0), 0);
                document.getElementById('total').innerText = totalCount.toLocaleString();

                const container = document.getElementById('inventory-groups');
                if (!items.length) {
                    container.innerHTML = `<div class="text-center py-20 text-neutral-600 font-black uppercase">Your inventory is empty</div>`;
                    return;
                }

                const groups = {};
                items.forEach(item => {
                    if (!groups[item.pack]) groups[item.pack] = [];
                    groups[item.pack].push(item);
                });

                container.innerHTML = '';

                for (const packName in groups) {
                    const packItems = groups[packName];
                    
                    
                    packItems.sort((a, b) => (rarityWeight[a.rarity] || 0) - (rarityWeight[b.rarity] || 0));

                    const section = document.createElement('div');
                    section.innerHTML = `
                        <div class="pack-header mb-8">
                            <h2 class="text-4xl font-black uppercase italic tracking-tighter">${packName} Pack</h2>
                            <p class="text-neutral-500 text-xs font-bold uppercase tracking-widest">${packItems.length} Unlocked</p>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
                            ${packItems.map(item => {
                                const color = rarityColors[item.rarity] || '#808080';
                                return `
                                    <div class="block-card bg-[#1a1a1a] border-2 p-6 rounded-[2rem] relative flex flex-col items-center transition-all" style="border-color: ${color}44;">
                                        <div class="absolute -top-2 -right-2 bg-white text-black font-black text-[10px] px-3 py-1 rounded-lg shadow-lg">${item.count}</div>
                                        <div class="w-24 h-24 mb-6 flex items-center justify-center">
                                            <img src="/blocks/${item.pack}/${item.file}" class="w-full h-full object-contain" style="filter: drop-shadow(0 0 8px ${color}66);">
                                        </div>
                                        <div class="text-center w-full">
                                            <div class="font-black uppercase text-[11px] truncate text-white">${item.name}</div>
                                            <div class="text-[9px] font-bold mt-1 tracking-tighter uppercase" style="color: ${color};">${item.rarity}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    container.appendChild(section);
                }

            } catch (err) { location.href = '/login'; }
        }
        loadInventory();
    </script>
</body>
</html>